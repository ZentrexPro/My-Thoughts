<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Love Quotes & Messages</title>

  <!-- Fonts -->
  <link href="https://fonts.googleapis.com/css2?family=Great+Vibes&family=Audiowide&display=swap" rel="stylesheet">

  <!-- Google Analytics (Website tracking - GA4) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-WYSBQ3FW82"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){ dataLayer.push(arguments); }
    gtag('js', new Date());
    gtag('config', 'G-WYSBQ3FW82');
  </script>

  <style>
    :root{
      --glass-bg: rgba(255,255,255,0.08);
      --accent:#00fff0;
      --pink:#ff4db6;
    }
    html,body{
      height:100%;
      margin:0;
      font-family: system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
      background: url("bg.jpg") no-repeat center center/cover;
      background-attachment: fixed;
      color: #fff;
      -webkit-font-smoothing:antialiased;
      -moz-osx-font-smoothing:grayscale;
      display:flex;
      flex-direction:column;
      align-items:center;
      padding:32px 18px;
      box-sizing:border-box;
    }

    /* subtle overlay for readability */
    body::after{
      content:"";
      position:fixed;
      inset:0;
      background: rgba(0,0,0,0.45);
      z-index:0;
      pointer-events:none;
    }

    /* Quote Card (glass) */
    .quote-card{
      position:relative;
      z-index:1;
      width:min(92%,540px);
      padding:28px;
      border-radius:18px;
      background: var(--glass-bg);
      backdrop-filter: blur(10px) saturate(120%);
      border: 1px solid rgba(255,255,255,0.12);
      box-shadow: 0 10px 30px rgba(0,0,0,0.6), inset 0 1px 0 rgba(255,255,255,0.02);
      text-align:center;
      margin-bottom:20px;
    }

    .quote-text{
      font-family: 'Great Vibes', cursive;
      font-size: 28px;
      line-height:1.2;
      color: #fff;
      text-shadow: 0 4px 18px rgba(0,0,0,0.6), 0 1px 0 rgba(255,255,255,0.02);
      display:inline-block;
      max-width:100%;
      white-space:pre-wrap;
      word-break:break-word;
    }

    /* caret (we use JS typing; caret style here when typing) */
    .typing-caret{
      border-right: 3px solid rgba(255,255,255,0.95);
      padding-right:6px;
      animation: blinkCaret 0.8s step-end infinite;
    }
    @keyframes blinkCaret{
      50%{ border-color: transparent; }
    }

    /* Messages box */
    .message-panel{
      z-index:1;
      width:min(92%,820px);
      max-width:820px;
      margin-top:12px;
      background: rgba(0,0,0,0.45);
      border-radius:14px;
      padding:14px;
      box-shadow: 0 8px 26px rgba(0,0,0,0.6);
      border:1px solid rgba(255,255,255,0.06);
      backdrop-filter: blur(6px);
    }

    .message-panel h3{
      margin:0 0 8px 0;
      font-family:'Audiowide',sans-serif;
      color:var(--accent);
      font-size:16px;
      letter-spacing:0.6px;
    }

    .compose{
      display:flex;
      gap:10px;
      margin-bottom:12px;
      align-items:flex-start;
    }

    .compose textarea{
      flex:1;
      min-height:72px;
      resize:vertical;
      padding:10px 12px;
      border-radius:8px;
      border:none;
      font-size:15px;
      background: #fff;
      color:#111;
      box-sizing:border-box;
    }

    .compose button{
      min-width:110px;
      padding:10px 12px;
      background: linear-gradient(180deg,var(--pink),#d1007a);
      border:none;
      color:#fff;
      border-radius:10px;
      font-weight:700;
      cursor:pointer;
      box-shadow:0 6px 18px rgba(209,0,122,0.18);
      align-self:flex-end;
    }

    /* public wall */
    #messagesList{
      max-height:320px;
      overflow:auto;
      padding-right:6px;
    }

    .msg-item{
      background: linear-gradient(90deg, rgba(0,255,240,0.06), rgba(255,255,255,0.02));
      border-radius:10px;
      padding:10px 12px;
      margin-bottom:10px;
      display:flex;
      align-items:flex-start;
      justify-content:space-between;
      gap:10px;
      font-size:15px;
      line-height:1.35;
    }
    .msg-text{
      flex:1;
      color:#fff;
      word-break:break-word;
      white-space:pre-wrap;
      font-family: Arial, sans-serif;
    }

    .msg-wand{
      margin-left:12px;
      cursor:pointer;
      font-size:20px;
      opacity:0.95;
      user-select:none;
    }
    .msg-wand:hover{ transform: scale(1.08) rotate(-6deg); }

    /* games button */
    .games-btn{
      z-index:1;
      margin-top:18px;
      padding:14px 26px;
      border-radius:26px;
      border:none;
      background:linear-gradient(90deg,var(--accent),#0072ff);
      color:#001;
      font-weight:800;
      cursor:pointer;
      box-shadow: 0 8px 30px rgba(0,0,0,0.5);
      font-size:16px;
    }

    /* small screens tweaks */
    @media (max-width:520px){
      .quote-text{ font-size:22px; }
      .compose button{ min-width:86px; padding:10px; }
    }
  </style>
</head>
<body>
  <!-- Quote card -->
  <div class="quote-card" role="region" aria-label="Quote">
    <div id="quoteEl" class="quote-text" aria-live="polite"></div>
  </div>

  <!-- Messages -->
  <div class="message-panel" role="region" aria-label="Messages">
    <h3>Message for me without your identity</h3>

    <div class="compose">
      <textarea id="newMsg" placeholder="Write your secret message..." aria-label="Write your secret message"></textarea>
      <button id="sendBtn" type="button">Send</button>
    </div>

    <div id="messagesList" aria-live="polite"></div>
  </div>

  <!-- Games -->
  <button class="games-btn" onclick="location.href='games.html'">üéÆ Play Mini Games</button>

  <!-- Firebase + app logic -->
  <script type="module">
    // Firebase modular imports
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-analytics.js";
    import { getDatabase, ref, push, onValue, remove } from "https://www.gstatic.com/firebasejs/10.13.2/firebase-database.js";

    // ---------- YOUR Firebase Config (you provided) ----------
    const firebaseConfig = {
      apiKey: "AIzaSyAkeirE4twM3J02JbDBnbdUw2G9yw8VVlw",
      authDomain: "love-messages-cdee7.firebaseapp.com",
      databaseURL: "https://love-messages-cdee7-default-rtdb.firebaseio.com",
      projectId: "love-messages-cdee7",
      storageBucket: "love-messages-cdee7.firebasestorage.app",
      messagingSenderId: "670131200783",
      appId: "1:670131200783:web:ea75b017acab258911547a",
      measurementId: "G-WT5TKSRSLG"
    };

    // init
    const app = initializeApp(firebaseConfig);
    try { getAnalytics(app); } catch(e){ /* analytics may fail in some environments */ console.warn('Firebase analytics init failed', e); }
    const db = getDatabase(app);
    const messagesRef = ref(db, 'messages');

    // ---------- Admin password ----------
    const ADMIN_PASS = "0420";

    // ---------- Quotes typing (types once and stops) ----------
    const quotes = [
      "You are the reason behind my smile üíï",
      "Every love story is beautiful, but ours is my favorite üåπ",
      "In your arms, I‚Äôve found my home ‚ù§Ô∏è",
      "Forever is not long enough with you üíû"
    ];
    const quoteEl = document.getElementById('quoteEl');

    // Function: type a given text char-by-char, return Promise when done
    function typeText(text, speed = 45) {
      return new Promise(resolve => {
        quoteEl.textContent = "";
        quoteEl.classList.add('typing-caret');
        let i = 0;
        const interval = setInterval(() => {
          quoteEl.textContent += text.charAt(i);
          i++;
          if (i >= text.length) {
            clearInterval(interval);
            // remove caret after a short pause
            setTimeout(() => quoteEl.classList.remove('typing-caret'), 400);
            resolve();
          }
        }, speed);
      });
    }

    // Play quotes one by one but stop after each completes and WAIT (not loop by default)
    // We'll show first quote on load.
    (async function showInitialQuote(){
      try{
        await typeText(quotes[0], 45);
      }catch(e){
        console.error(e);
        quoteEl.textContent = quotes[0];
      }
    })();

    // ---------- Messages: realtime with Firebase ----------
    const messagesListEl = document.getElementById('messagesList');

    // Render function: snapshot is object map id => {text, ts}
    function renderSnapshot(snapshotVal){
      messagesListEl.innerHTML = "";
      if(!snapshotVal) return;
      // convert to array of {id, text, ts} and sort by ts desc (latest first)
      const arr = Object.keys(snapshotVal).map(id => {
        const it = snapshotVal[id];
        return { id, text: it.text || '', ts: it.ts || 0 };
      }).sort((a,b) => b.ts - a.ts);

      arr.forEach(item => {
        const d = document.createElement('div');
        d.className = 'msg-item';

        const span = document.createElement('div');
        span.className = 'msg-text';
        // use textContent to avoid XSS
        span.textContent = item.text;

        const wand = document.createElement('div');
        wand.className = 'msg-wand';
        wand.textContent = 'ü™Ñ';
        wand.title = 'Remove (admin only)';

        wand.addEventListener('click', async () => {
          const pass = prompt('Enter admin password to remove this message:');
          if (pass === ADMIN_PASS) {
            try {
              await remove(ref(db, 'messages/' + item.id));
            } catch(err) {
              alert('Delete failed, try again.');
              console.error(err);
            }
          } else if(pass !== null) {
            alert('‚ùå Wrong password!');
          }
        });

        d.appendChild(span);
        d.appendChild(wand);
        messagesListEl.appendChild(d);
      });
    }

    // Realtime listener
    onValue(messagesRef, (snap) => {
      renderSnapshot(snap.exists() ? snap.val() : null);
    }, (err) => {
      console.error('Firebase onValue error', err);
    });

    // Send message
    const sendBtn = document.getElementById('sendBtn');
    const newMsgEl = document.getElementById('newMsg');
    sendBtn.addEventListener('click', async () => {
      const text = (newMsgEl.value || "").trim();
      if (!text) { alert('Please write something!'); return; }
      try {
        await push(messagesRef, { text, ts: Date.now() });
        newMsgEl.value = "";
      } catch(err) {
        console.error('Failed to send', err);
        alert('Send failed. Check console.');
      }
    });

    // allow Enter+Ctrl to send quickly
    newMsgEl.addEventListener('keydown', (e)=>{
      if(e.key === 'Enter' && (e.ctrlKey || e.metaKey)) {
        sendBtn.click();
      }
    });
  </script>
</body>
  </html>
